<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wing Chun Simon – Diagnostic</title>
<style>
  html,body{ margin:0; height:100%; background:#0b0b0b; color:#eee; font-family:sans-serif; }
  canvas{ display:block; width:100%; height:100%; }
  #err { position:fixed; left:0; right:0; top:0; padding:6px; text-align:center;
         color:#fff; background:#a00; font-size:13px; display:none; z-index:10 }
</style>
</head>
<body>
<div id="err"></div>
<canvas id="c"></canvas>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.155.0/build/three.module.js';
import { GLTFLoader } from 'https://unpkg.com/three@0.155.0/examples/jsm/loaders/GLTFLoader.js';
import { DRACOLoader } from 'https://unpkg.com/three@0.155.0/examples/jsm/loaders/DRACOLoader.js';

// Affiche toute erreur
window.addEventListener('error', e => {
  const el = document.getElementById('err');
  el.textContent = 'JS Error: ' + (e.error?.message || e.message);
  el.style.display = 'block';
});
window.addEventListener('unhandledrejection', e => {
  const el = document.getElementById('err');
  el.textContent = 'Promise Error: ' + (e.reason?.message || e.reason);
  el.style.display = 'block';
});

const canvas = document.getElementById('c');
const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,2));

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0e0e12);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0,1.6,6);
scene.add(camera);

scene.add(new THREE.AmbientLight(0xffffff,0.3));
const dl = new THREE.DirectionalLight(0xffffff,1.2);
dl.position.set(2,4,2);
scene.add(dl);

// Cube test (si vous ne voyez pas ce cube, le problème est dans le moteur)
const cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshNormalMaterial());
cube.position.set(-2,1,0);
scene.add(cube);

// Tentative de chargement du GLB
async function loadGLB(){
  try {
    const loader = new GLTFLoader();
    const draco = new DRACOLoader();
    draco.setDecoderPath('https://unpkg.com/three@0.155.0/examples/jsm/libs/draco/');
    loader.setDRACOLoader(draco);

    const url = './assets/sounds/MaleCharBaseMesh.glb';
    console.log('Chargement depuis', url);
    const gltf = await loader.loadAsync(url);
    console.log('GLB chargé', gltf);

    const model = gltf.scene;
    model.position.set(0,0,0);
    scene.add(model);
  } catch (e) {
    const el = document.getElementById('err');
    el.textContent = 'Erreur chargement GLB: ' + e.message;
    el.style.display = 'block';
  }
}
loadGLB();

addEventListener('resize', ()=>{
  renderer.setSize(innerWidth, innerHeight);
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
});

function animate(){
  cube.rotation.y += 0.01;
  renderer.render(scene,camera);
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
